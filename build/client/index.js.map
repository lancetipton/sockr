{"version":3,"file":"index.js","sources":["../../src/client/context/context.js","../../src/client/hooks/useSockr.js","../../src/client/hocs/sockrHoc.js","../../src/client/reducer/sockrState.js","../../src/client/hooks/useSockrItems.js","../../src/constants/eventTypes.js","../../src/client/constants/index.js","../../src/client/actions/addPeer.js","../../src/client/actions/setId.js","../../src/client/actions/setCmds.js","../../src/client/actions/init.js","../../src/client/actions/connect.js","../../src/client/actions/toggleIsRunning.js","../../src/client/actions/cmdEnd.js","../../src/client/actions/cmdErr.js","../../src/client/actions/cmdFail.js","../../src/client/actions/cmdOut.js","../../src/client/actions/peerDisconnect.js","../../src/client/service/socketService.js","../../src/client/reducer/sockrReducer.js","../../src/client/reducer/joinReducers.js","../../src/client/reducer/useSockrReducer.js","../../src/client/context/SockrProvider.js"],"sourcesContent":["import React from 'react'\n\n/**\n * Creates the initial theme context\n */\nexport const SocketContext = React.createContext(null)\n","import { SocketContext } from '../context/context'\nimport { useContext } from 'react'\n\n/**\n * Helper hook to get the websocket content\n * @function\n * @public\n * @export\n *\n * @returns {Object} websocket context object\n */\nexport const useSockr = () => {\n  return useContext(SocketContext)\n}\n","import { useSockr } from '../hooks/useSockr'\nimport React from 'react'\n\n/**\n * Websocket HOC component\n * @function\n * @public\n * @export\n * @param {Object} props\n *\n */\nexport const SockrHoc = Component => {\n  const websocket = useSockr()\n  return props => <Component {...props} websocket={websocket} />\n}\n","/**\n * Cache holder for the sockr sate object\n * Should be update every time the sockr reducer state is changed\n * @type Object\n * @private\n *\n */\nlet _SOCKR_STATE\n\n/**\n * Cache holder for the sockr dispatch method\n * @function\n * @private\n *\n * @returns {void}\n */\nlet _SOCKR_DISPATCH = () =>\n  console.warn(`Sockr Dispatch has not been initialized!`)\n\n/**\n * Helper to get the sockrDispatch method\n * @function\n * @public\n * @export\n *\n * @returns {function} Sockr dispatch method\n */\nexport const getState = () => _SOCKR_STATE\n\n/**\n * Helper to get the sockrDispatch method\n * @function\n * @public\n * @export\n *\n * @returns {function} Sockr dispatch method\n */\nexport const getDispatch = () => _SOCKR_DISPATCH\n\n/**\n * Sets the internally managed sockr state object\n * @function\n * @public\n * @export\n * @param {Object} next - The next state object\n *\n * @returns {void}\n */\nexport const setNextState = next => {\n  _SOCKR_STATE = next\n}\n\n/**\n * Sets the internally managed sockr dispatch function\n * @function\n * @public\n * @export\n * @param {function} dispatch - The store dispatch function\n *\n * @returns {void}\n */\nexport const setDispatch = dispatch => {\n  _SOCKR_DISPATCH = dispatch\n}\n\n/**\n * Helper matching the redux API to get the getState and getDispatch methods\n * @function\n * @public\n * @export\n * @param {function} dispatch - The store dispatch function\n *\n * @returns {void}\n */\nexport const getStore = () => {\n  return {\n    getState,\n    getDispatch,\n  }\n}\n","import { useMemo, useRef } from 'react'\nimport { getState } from '../reducer/sockrState'\nimport { get, noPropArr, clearObj, eitherArr } from '@keg-hub/jsutils'\n\n/**\n * Hook to extract a single values from the sockr state object\n * Memoizes the extracted values and returns them as an object\n * Only updates the values when the store property matching a key statePaths has updated\n * This avoids re-renders when the state object has change, but a value has not\n * @function\n * @public\n * @export\n * @returns {Array} statePaths - Paths to values on the current sockr state\n *\n * @returns {Object} Memoize values from the state\n */\nexport const useSockrItems = (findPaths = noPropArr) => {\n  // Ensure we have an array to call reduce on\n  const statePaths = eitherArr(findPaths, [findPaths])\n\n  // Get the current state to allow pulling the values with statePaths\n  const state = getState()\n\n  // Memoize the current values from the state at statePaths\n  // If the state updates, but not the values from statePaths,\n  // then this hook with run, but the returned values will be the same\n  // Or it will get the updated values when the state has changes\n  // Either way, the values should always be the correct values in the state\n  const values = useMemo(() => {\n    return statePaths.reduce((found, valPath) => {\n      found[valPath] = get(state, valPath)\n\n      return found\n    }, {})\n  }, [ state, statePaths ])\n\n  // Init the sockrRef to store the initial value\n  const sockrRef = useRef(values)\n\n  // Memoize the values and sockrRef.current\n  // Loop each property in values and\n  // Update sockrRef.current to the current state value\n  // Then return sockrRef.current\n  // This way the values are only ever updated it it's they changed on that state changed\n  // If the state object changes, but not the values, then the original values are returned\n  return useMemo(() => {\n    // Clear out all keys from the current ref\n    // This also keeps the same identity of the ref object\n    // Which means we should check the children for updates, not the root object\n    clearObj(sockrRef.current)\n\n    // Loop the values and add the current values to the ref\n    // This puts back any values we removed in the clearObj method call\n    // If the value never changed, then the ref should have the same value again\n    // But it removes any properties that should not longer exist\n    Object.entries(values).map(\n      ([ key, value ]) => (sockrRef.current[key] = value)\n    )\n\n    return sockrRef.current\n  }, [ values, sockrRef && sockrRef.current ])\n}\n","const TAG_PREFIX = 'SOCKr'\n\nconst EventTypes = {\n  // General\n  INIT: `${TAG_PREFIX}:INIT`,\n  SET_ID: `${TAG_PREFIX}:SET_ID`,\n  CONNECT: `${TAG_PREFIX}:CONNECT`,\n\n  // STORE\n  UPDATE_STORE: `${TAG_PREFIX}:UPDATE_STORE`,\n\n  // Auth\n  AUTH_TOKEN: `${TAG_PREFIX}:AUTH_TOKEN`,\n  NOT_AUTHORIZED: `${TAG_PREFIX}:NOT_AUTHORIZED`,\n\n  // Peer\n  ADD_PEER: `${TAG_PREFIX}:ADD_PEER`,\n  PEER_DISCONNECT: `${TAG_PREFIX}:PEER_DISCONNECT`,\n\n  // Command\n  SET_CMDS: `${TAG_PREFIX}:SET_CMDS`,\n  RUN_CMD: `${TAG_PREFIX}:RUN_CMD`,\n  CMD_RUNNING: `${TAG_PREFIX}:CMD_RUNNING`,\n  CMD_END: `${TAG_PREFIX}:CMD_END`,\n  CMD_OUT: `${TAG_PREFIX}:CMD_OUT`,\n  CMD_ERR: `${TAG_PREFIX}:CMD_ERR`,\n  CMD_FAIL: `${TAG_PREFIX}:CMD_FAIL`,\n}\n\nmodule.exports = {\n  EventTypes,\n  tagPrefix: TAG_PREFIX,\n}\n","// This is a work-around due to rollup adding jsutils as a default export\n// We do the deepFreeze here instead of in the shared constants file\n// This works around module.exports vs exports issues\nimport { deepFreeze } from '@keg-hub/jsutils'\nimport { EventTypes, tagPrefix } from '../../constants/eventTypes'\nconst frozenEvents = deepFreeze(EventTypes)\n\nexport { tagPrefix, frozenEvents as EventTypes }\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\n\n/**\n * Dispatches a connected peers id\n * @param {Object} id - Id of the peer that has connected\n * @param {Array} peers - Currently connected peers\n *\n * @returns {void}\n */\nexport const addPeer = ({ id, peers }) => {\n  return getDispatch()({\n    type: EventTypes.ADD_PEER,\n    id,\n    peers,\n  })\n}\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\n\n/**\n * Dispatches that a peer has disconnected\n * @param {Object} id - Id of the connected socket\n * @param {Boolean} isRunning - Is the backend running a command\n * @param {Boolean} data - Extra metadata sent from the backend\n *\n * @returns {void}\n */\nexport const setId = ({ id, data, isRunning }) => {\n  getDispatch()({\n    type: EventTypes.SET_ID,\n    id,\n    isRunning,\n    ...data,\n  })\n}\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\n\n/**\n * Dispatches passed in commands to the reducers\n * @param {Object} data - Message data from the socket\n *\n * @returns {void}\n */\nexport const setCmds = ({ data: { commands } }) => {\n  return getDispatch()({\n    commands,\n    type: EventTypes.SET_CMDS,\n  })\n}\n","import { noOpObj } from '@keg-hub/jsutils'\nimport { setId } from './setId'\nimport { setCmds } from './setCmds'\n\n/**\n * Initializes the store when the web-socket is initialised\n * Makes call to store the allowed commands and sets the sockets id\n * @param {Object} data - Message data from the socket\n *\n * @returns {void}\n */\nexport const init = (data = noOpObj, service = noOpObj) => {\n  setCmds(data, service)\n  setId(data, service)\n}\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\n\n/**\n * Dispatches event that the web-socket has connected\n *\n * @returns {void}\n */\nexport const connect = () => {\n  return getDispatch()({\n    type: EventTypes.CONNECT,\n    connected: true,\n  })\n}\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\n\n/**\n * Toggles if the backend is running a command\n * @param {Boolean} isRunning - Is the backend running a command\n * @param {string} name - Name of the command being run\n *\n * @returns {void}\n */\nexport const toggleIsRunning = ({ isRunning, name }) => {\n  getDispatch()({\n    type: EventTypes.CMD_RUNNING,\n    isRunning,\n    name,\n  })\n}\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\nimport { toggleIsRunning } from './toggleIsRunning'\n\n/**\n * Dispatches when a command has finished running\n * Makes call to toggleIsRunning, to turn it off\n * @param {Object} data - Message data from the socket\n *\n * @returns {void}\n */\nexport const cmdEnd = data => {\n  return (\n    data &&\n    data.message &&\n    getDispatch()({\n      type: EventTypes.CMD_END,\n      ...data,\n    })\n  )\n\n  toggleIsRunning(data)\n}\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\n\n/**\n * Dispatches an error message that occurred on while a command was running\n * @param {Object} data - Message data from the socket\n *\n * @returns {void}\n */\nexport const cmdErr = data => {\n  data &&\n    data.message &&\n    getDispatch()({\n      type: EventTypes.CMD_ERR,\n      ...data,\n    })\n}\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\nimport { toggleIsRunning } from './toggleIsRunning'\n\n/**\n * Dispatches an error that occurred on while a command was running\n * Makes call to toggleIsRunning, to turn it off\n * @param {Object} data - Message data from the socket\n *\n * @returns {void}\n */\nexport const cmdFail = (data, service) => {\n  return (\n    data &&\n    data.message &&\n    getDispatch()({\n      type: EventTypes.CMD_FAIL,\n      ...data,\n    })\n  )\n\n  toggleIsRunning(data, service)\n}\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\n\n/**\n * Dispatches an output message that occurred on while a command was running\n * @param {Object} data - Message data from the socket\n *\n * @returns {void}\n */\nexport const cmdOut = data => {\n  data &&\n    data.message &&\n    getDispatch()({\n      type: EventTypes.CMD_OUT,\n      ...data,\n    })\n}\n","import { EventTypes } from '../constants'\nimport { getDispatch } from '../reducer/sockrState'\n\n/**\n * Dispatches that a peer has disconnected\n * @param {Object} id - Id of the peer that has disconnected\n * @param {Array} peers - Currently connected peers\n *\n * @returns {void}\n */\nexport const peerDisconnect = ({ id, peers }) => {\n  return getDispatch()({\n    type: EventTypes.DISCONNECT_PEER,\n    id,\n    peers,\n  })\n}\n","import io from 'socket.io-client'\nimport {\n  checkCall,\n  get,\n  isFunc,\n  noOpObj,\n  camelCase,\n  snakeCase,\n  isObj,\n} from '@keg-hub/jsutils'\nimport { EventTypes, tagPrefix } from '../constants'\nimport * as InternalActions from '../actions'\n\n/**\n * Builds the websocket endpoint to connect to the backend websocket\n * @function\n * @private\n *\n * @param {Object} config - Websocket client config object matching the config spec\n *\n * @returns {string} - Built websocket endpoint\n */\nconst buildEndpoint = config => {\n  // Use the same http protocol as what the current window is using\n  const protocol = get(window, 'location.protocol', 'https:')\n  return config.port\n    ? `${protocol}//${config.host}:${config.port}`\n    : config.host\n}\n\n/**\n * Calls the passed in actions with the received message and SocketService class instance\n * @function\n * @private\n *\n * @param {function} action - Method to be called relative to the event type\n * @param {Object} message - Data received from the websocket\n * @param {Object} instance - SocketService class instance\n * @param {string} event - Type of socket event receive\n *\n * @returns {*} Response from the action method\n */\nconst checkCallEvent = (action, message, instance, event) => {\n  return checkCall(action, message, instance, event)\n}\n\n/**\n * Calls internal and custom actions with the received message and SocketService class instance\n * @function\n * @private\n *\n * @param {Object} instance - SocketService class instance\n * @param {string} event - Type of socket event receive\n * @param {function} action - Method to be called relative to the event type\n * @param {Object} message - Data received from the websocket\n *\n * @returns {void}\n */\nconst callAction = (instance, event, action) => {\n  const eventName = camelCase((event.split(':')[1] || '').toLowerCase())\n\n  return data => {\n    if (!eventName) return instance.logData(`Invalid event name!`, event)\n\n    // Parse the data from string to object\n    const message = data && JSON.parse(data)\n\n    // Log the event for debugging\n    instance.logEvent(event, message)\n\n    // Look for the init event, and pull out the commands from it\n    // Init should only happen when we connect to the socket\n    eventName === 'init' && (instance.commands = get(message, 'data.commands'))\n\n    // Call the default internal action if it exists\n    const internal = InternalActions[eventName]\n    internal && checkCallEvent(internal, message, instance, event)\n\n    // Call the custom action if it exists\n    const customEvent = get(instance.config, `events.${eventName}`)\n    customEvent && checkCallEvent(customEvent, message, instance, event)\n\n    // Call the all action if it exists\n    // Is called for all sockr events that happen on the frontend\n    const allEvent = get(instance.config, `events.all`)\n    allEvent && checkCallEvent(allEvent, message, instance, event)\n  }\n}\n\n/**\n * Find the command from the commands ID\n * Searches through all loaded command, looking for a matching id\n * Otherwise returns false\n * @function\n * @private\n *\n * @param {Object} commands - All commands loaded from the back end\n * @param {Object|string} cmdOrId - Command object or id of the command\n *\n * @returns {Object|boolean} - The found command object or false\n */\nconst getCommand = (commands, cmdOrId) => {\n  const cmdId = isObj(cmdOrId) ? cmdOrId.id : cmdOrId\n\n  return Object.entries(commands).reduce((found, [ group, subCmds ]) => {\n    return found\n      ? found\n      : Object.entries(subCmds).reduce((subFound, [ name, definition ]) => {\n        return !subFound && isObj(definition) && definition.id === cmdId\n          ? definition\n          : subFound\n      }, false)\n  }, false)\n}\n\n/**\n * Service class for managing client websocket events\n * @function\n * @private\n *\n * @param {Object} config - Websocket client config object matching the config spec\n * @param {function} dispatch - Method to be called to update the websocket state\n * @param {string} token - Auth token for connecting to the websocket\n *\n * @returns {Object} - Instance of SocketService\n */\nexport class SocketService {\n  /**\n   * Helper to log data when logDebug is true\n   * @memberof SocketService\n   * @type function\n   * @public\n   * @param {*} data - Items to be logged\n   *\n   * @returns {void}\n   */\n  logData(...data) {\n    this.logDebug && console.log(...data)\n  }\n\n  /**\n   * Helper to log events when logDebug is true\n   * @memberof SocketService\n   * @type function\n   * @public\n   * @param {string} event - Websocket event to be logged\n   * @param {*} data - Items to be logged\n   *\n   * @returns {void}\n   */\n  logEvent(event, ...data) {\n    this.logDebug && console.log(`Socket Event: ${event}`, ...data)\n  }\n\n  /**\n   * Initializes the web-socket based on the passed in config\n   * Starts initial handshake to connect with the backend\n   * @memberof SocketService\n   * @type function\n   * @public\n   *\n   * @param {Object} config - Options for setting up the websocket\n   * @param {string} token - Auth token for validating with the backend\n   * @param {boolean} logDebug - Should log Socket events as the happen\n   *\n   * @returns {void}\n   */\n  initSocket(config, token, logDebug = false) {\n    // If the sockets already setup, just return\n    if (this.socket) return\n\n    this.config = config\n    this.logDebug = logDebug\n\n    const endpoint = buildEndpoint(config)\n\n    this.logData(`Connecting to backend socket => ${endpoint}${config.path}`)\n\n    // Setup the socket, and connect to the server\n    this.socket = io(endpoint, {\n      path: config.path,\n      transports: [ 'websocket', 'polling', 'flashsocket' ],\n    })\n\n    this.addEvents(token)\n  }\n\n  /**\n   * Initializes the web-socket based on the passed in config\n   * Starts initial handshake to connect with the backend\n   * @memberof SocketService\n   * @type Object\n   * @public\n   *\n   * @param {Object} config - Options for setting up the websocket\n   * @param {string} token - Auth token for validating with the backend\n   * @param {boolean} logDebug - Should log Socket events as the happen\n   *\n   * @returns {void}\n   */\n  addEvents(token) {\n    if (!this.socket) return\n\n    // Map the custom config.events with valid actions\n    // To listeners on the websocket\n    // Skip if an event type matching an internal event\n    // Custom event types with the same name as internal event\n    // Get called within the callAction of the registered internal event\n    Object.entries(get(this.config, 'events', noOpObj)).map(\n      ([ name, action ]) => {\n        const namCaps = snakeCase(name).toUpperCase()\n        if (namCaps === 'ALL') return\n\n        const eventType = `${tagPrefix}:${namCaps}`\n\n        isFunc(action) &&\n          !EventTypes[namCaps] &&\n          this.socket.on(eventType, callAction(this, eventType))\n      }\n    )\n\n    // Socket Map Event types to internal actions\n    Object.entries(EventTypes).map(([ key, eventType ]) => {\n      this.socket.on(eventType, callAction(this, eventType))\n    })\n\n    // Initial connection to the server through the socket\n    // Call the onConnection method which will handel authorization\n    this.socket.on(`connect`, this.onConnection.bind(this, token))\n  }\n\n  /**\n   * Callback method called when the websocket connects to the backend\n   * @memberof SocketService\n   * @type function\n   * @public\n   * @param {string} token - Auth token for validating with the backend\n   * @param {Object} data - Content sent from the backend\n   *\n   * @returns {void}\n   */\n  onConnection(token, data) {\n    // TODO: Implement token auth\n    // Send the token to the server to be validated\n    // this.emit(EventTypes.AUTH_TOKEN, { token: token })\n    // Then call the `callAction` with the connected event args\n    const connectAction = callAction(this, `${tagPrefix}:CONNECT`)\n    connectAction(data)\n  }\n\n  /**\n   * Sends an event to the connected backend through websocket ( Like an REST API call )\n   * @memberof SocketService\n   * @type function\n   * @public\n   * @param {string} event - Name of the event to emit ( Sent to the backend )\n   * @param {Object} data - Content sent to the backend\n   *\n   * @returns {void}\n   */\n  emit = (event, data) => {\n    if (!this.socket)\n      return console.error(`Socket not connected, cannot emit socket event!`)\n\n    if (!event)\n      return console.error(\n        `Event type is missing, cannot emit socket event without an event type!`,\n        event\n      )\n\n    this.logData(`Sending Socket Event: ${event}`, data)\n\n    // Send a message to the server\n    this.socket.emit(event, data)\n  }\n\n  /**\n   * Builds the command to be run, and sends it to the backend\n   * @memberof SocketService\n   * @type function\n   * @public\n   * @param {Object|string} command - Command data used to build the command for the backend\n   *                                  Or the id of the command to be run\n   *\n   * @returns {void}\n   */\n  runCommand(command, params) {\n    const { id, cmd, name, group } = getCommand(this.commands, command)\n    return this.emit(EventTypes.RUN_CMD, {\n      id,\n      cmd,\n      name,\n      group,\n      params,\n    })\n  }\n\n  /**\n   * Disconnects from the backend websocket\n   * Cleans up any open object || handles\n   * @memberof SocketService\n   * @type function\n   * @public\n   *\n   * @returns {void}\n   */\n  disconnect = () => {\n    if (!this.socket) return this.logData(`Socket already disconnected!`)\n\n    this.logData(`Disconnecting from Socket!`)\n    this.socket.disconnect()\n    this.socket = undefined\n    this.config = undefined\n    this.dispatch = undefined\n  }\n}\n\nexport const WSService = new SocketService()\n","import { EventTypes } from '../constants'\nimport { noOpObj } from '@keg-hub/jsutils'\n\n/**\n * Initial state of the sockr reducer\n * @type Object\n */\nconst initialState = {\n  connected: false,\n  peers: [],\n  id: null,\n  runningCmd: null,\n  isRunning: false,\n  server: noOpObj,\n  events: noOpObj,\n}\n\n/**\n * Default reducer for sockr\n * @type function\n * @public\n * @export\n * @param {Object} [state=initialState] - Initial state of the reducer\n * @param {Object} action - Properties define how to update the current reducer state\n *\n * @returns {Object} Reducers state with the actions updates applied\n */\nexport const sockrReducer = (state = initialState, action) => {\n  if (!state || !action || !action.type) return state\n\n  switch (action.type) {\n  case EventTypes.CONNECT: {\n    return action.connected === state.connected\n      ? state\n      : {\n          ...state,\n          connected: true,\n        }\n  }\n\n  case EventTypes.SET_ID: {\n    const { type, ...updates } = action\n    return !action.id\n      ? state\n      : {\n          ...state,\n          ...updates,\n        }\n  }\n\n  case EventTypes.CMD_RUNNING: {\n    return action.isRunning === state.isRunning\n      ? state\n      : {\n          ...state,\n          runningCmd: (action.isRunning && action.name) || null,\n          isRunning: action.isRunning,\n        }\n  }\n\n  case EventTypes.ADD_PEER: {\n    return !action.peers\n      ? state\n      : {\n          ...state,\n          peers: action.peers,\n        }\n  }\n\n  case EventTypes.DISCONNECT_PEER: {\n    return !action.peers\n      ? state\n      : {\n          ...state,\n          peers: action.peers,\n        }\n  }\n\n  default: {\n    return state\n  }\n  }\n}\n","import { isFunc } from '@keg-hub/jsutils'\n\n/**\n * Cache holder for the joined reducers function\n * @type function\n * @private\n */\nlet _JOINED_REDUCERS\n\n/**\n * Joins the custom reducer method with the default sockr reducer\n * @function\n * @public\n * @export\n * @param {function} sockrReducer - Default sockr reducer\n * @param {function} customReducer - Custom reducer passed in by the sockr consumer\n *\n * @returns {function} Single reducer function\n */\nexport const joinReducers = (sockrReducer, customReducer) => {\n  // If the joined reducers are already set, just return them\n  if (_JOINED_REDUCERS) return _JOINED_REDUCERS\n\n  // Set the join reducer function, then return it\n  _JOINED_REDUCERS = (state, action) => {\n    // First update the internal reducer\n    const updatedState = sockrReducer(state, action)\n\n    // Then check if we should call the customReducer\n    return isFunc(customReducer)\n      ? customReducer(updatedState, action)\n      : updatedState\n  }\n\n  return _JOINED_REDUCERS\n}\n","import { useReducer } from 'react'\nimport { sockrReducer } from './sockrReducer'\nimport { joinReducers } from './joinReducers'\nimport { deepMerge } from '@keg-hub/jsutils'\nimport { getDispatch, getState, setNextState, setDispatch } from './sockrState'\n\n/**\n * Call the sockr reducer to get the initial state\n * @object\n */\nconst initialState = sockrReducer()\n\n// Set the initial sate to the sockrState object\nsetNextState(initialState)\n\n/**\n * Hook to setup the sockr reducer and initialize the sockr state\n * Also joins the custom reducer and state with the defaults\n * @function\n * @public\n * @export\n * @param {function} customReducer - Custom reducer passed in by the sockr consumer\n * @param {Object} customInitialState - Custom initial state to override the defaults\n *\n * @returns {function} Single reducer function\n */\nexport const useSockrReducer = (customReducer, customInitialState) => {\n  // Join the reducers if a custom reducer is passed in\n  // And build the reducers with the joined default state and custom state\n  const [ state, dispatch ] = useReducer(\n    joinReducers(sockrReducer, customReducer),\n    deepMerge(initialState, customInitialState)\n  )\n\n  // Update the internal state so we can keep track of it\n  getState() !== state && setNextState(state)\n\n  // Technically the dispatch method should never change, so no need to memoize\n  getDispatch() !== dispatch && setDispatch(dispatch)\n\n  return state\n}\n","import { WSService } from '../service'\nimport { SocketContext } from './context'\nimport { noOpObj } from '@keg-hub/jsutils'\nimport React, { useEffect } from 'react'\nimport { useSockrReducer } from '../reducer/useSockrReducer'\n\nconst isDev = process.env.NODE_ENV === 'development'\n\n/**\n * Component to memoize the children of the context provider\n * @function\n * @private\n * @param {Object} props\n * @param {function} props.children - Children components passed to the Provider\n *\n */\n// eslint-disable-next-line no-unused-vars\nconst MemoChildren = React.memo(props => <>{props.children}</>)\n\n/**\n * Websocket Provider component. Should wrap a react application as a Provider\n * @function\n * @public\n * @export\n * @param {Object} props\n * @param {function} props.reducer - Custom websocket reducer function\n * @param {Object} props.initialState - Custom initial state for the reducer\n *\n * @returns {Object} sockr model object\n */\nexport const SockrProvider = props => {\n  const { children, config, reducer, token, debug } = props\n\n  const websocket = useSockrReducer(reducer, config || noOpObj)\n\n  // Only init the websocket on initial render\n  // Don't update the websocket after that\n  // All config values must be setup from the start\n  useEffect(() => {\n    WSService &&\n      !WSService.socket &&\n      WSService.initSocket(websocket, token, debug)\n\n    return () => !isDev && WSService.disconnect()\n  }, [])\n\n  return (\n    <SocketContext.Provider value={websocket}>\n      <MemoChildren>{children}</MemoChildren>\n    </SocketContext.Provider>\n  )\n}\n"],"names":["SocketContext","React","createContext","useSockr","useContext","SockrHoc","Component","websocket","props","_SOCKR_STATE","_SOCKR_DISPATCH","console","warn","getState","getDispatch","setNextState","next","setDispatch","dispatch","useSockrItems","findPaths","noPropArr","statePaths","eitherArr","state","values","useMemo","reduce","found","valPath","get","sockrRef","useRef","clearObj","current","Object","entries","map","key","value","TAG_PREFIX","EventTypes","INIT","SET_ID","CONNECT","UPDATE_STORE","AUTH_TOKEN","NOT_AUTHORIZED","ADD_PEER","PEER_DISCONNECT","SET_CMDS","RUN_CMD","CMD_RUNNING","CMD_END","CMD_OUT","CMD_ERR","CMD_FAIL","module","tagPrefix","frozenEvents","deepFreeze","addPeer","id","peers","type","setId","data","isRunning","setCmds","commands","init","noOpObj","service","connect","connected","toggleIsRunning","name","cmdEnd","message","cmdErr","cmdFail","cmdOut","peerDisconnect","DISCONNECT_PEER","buildEndpoint","config","protocol","window","port","host","checkCallEvent","action","instance","event","checkCall","callAction","eventName","camelCase","split","toLowerCase","logData","JSON","parse","logEvent","internal","InternalActions","customEvent","allEvent","getCommand","cmdOrId","cmdId","isObj","group","subCmds","subFound","definition","SocketService","socket","error","emit","disconnect","undefined","logDebug","log","initSocket","token","endpoint","path","io","transports","addEvents","namCaps","snakeCase","toUpperCase","eventType","isFunc","on","onConnection","bind","connectAction","runCommand","command","params","cmd","WSService","initialState","runningCmd","server","events","sockrReducer","updates","_JOINED_REDUCERS","joinReducers","customReducer","updatedState","useSockrReducer","customInitialState","useReducer","deepMerge","isDev","process","env","NODE_ENV","MemoChildren","memo","children","SockrProvider","reducer","debug","useEffect"],"mappings":"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"}